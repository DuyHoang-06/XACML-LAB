<?xml version="1.0" encoding="UTF-8"?>
<Policy xmlns="urn:oasis:names:tc:xacml:3.0:core:schema:wd-17"
        PolicyId="enterprise-access-policy"
        RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:permit-overrides">

    <Target/>

    <!-- Rule 1: Admin có toàn quyền -->
    <Rule RuleId="rule-admin-full-access" Effect="Permit">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">admin</AttributeValue>
                        <AttributeDesignator AttributeId="role" Category="subject" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

    <!-- Rule 2: Manager được đọc tài nguyên tài chính -->
    <Rule RuleId="rule-manager-read-finance" Effect="Permit">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">manager</AttributeValue>
                        <AttributeDesignator AttributeId="role" Category="subject" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">finance</AttributeValue>
                        <AttributeDesignator AttributeId="resource" Category="resource" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">read</AttributeValue>
                        <AttributeDesignator AttributeId="action" Category="action" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

    <!-- Rule 3: Nhân viên chỉ đọc tài nguyên public -->
    <Rule RuleId="rule-employee-read-public" Effect="Permit">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">employee</AttributeValue>
                        <AttributeDesignator AttributeId="role" Category="subject" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">public</AttributeValue>
                        <AttributeDesignator AttributeId="resource" Category="resource" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">read</AttributeValue>
                        <AttributeDesignator AttributeId="action" Category="action" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

    <!-- Rule 4: Guest bị từ chối mọi truy cập -->
    <Rule RuleId="rule-guest-deny-all" Effect="Deny">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">guest</AttributeValue>
                        <AttributeDesignator AttributeId="role" Category="subject" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

    <!-- Rule 5: Truy cập ngoài giờ hành chính bị từ chối -->
    <Rule RuleId="rule-off-hours-deny" Effect="Deny">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">false</AttributeValue>
                        <AttributeDesignator AttributeId="working_hours" Category="environment" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

    <!-- Rule 6: Manager không được xóa tài nguyên tài chính -->
    <Rule RuleId="rule-manager-deny-delete-finance" Effect="Deny">
        <Target>
            <AnyOf>
                <AllOf>
                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">manager</AttributeValue>
                        <AttributeDesignator AttributeId="role" Category="subject" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">finance</AttributeValue>
                        <AttributeDesignator AttributeId="resource" Category="resource" DataType="string"/>
                    </Match>

                    <Match MatchId="string-equal">
                        <AttributeValue DataType="string">delete</AttributeValue>
                        <AttributeDesignator AttributeId="action" Category="action" DataType="string"/>
                    </Match>
                </AllOf>
            </AnyOf>
        </Target>
    </Rule>

</Policy>